---

- name: Download Oracle Java PGP key (works with Bionic behind a proxy)
  become: yes
  get_url:
    dest: /usr/local/src/java_oracle.asc
    mode: 0644
    url: "https://{{ sansible_java_apt_oracle_keyserver }}/pks/lookup?op=get&search=0x{{ sansible_java_apt_oracle_key_id }}"

- name: Ensures Oracle Java PGP key is known
  become: yes
  apt_key:
    file: /usr/local/src/java_oracle.asc
    id: "{{ sansible_java_apt_oracle_key_id }}"
    state: present

- name: Add Oracle Java repo
  become: yes
  apt_repository:
    repo: "{{ sansible_java_apt_oracle_repo }}"
    state: present
    update_cache: yes

- name: Accept Oracle Java license
  become: yes
  debconf:
    name: "oracle-java{{ sansible_java_version }}-installer"
    question: shared/accepted-oracle-license-v1-1
    value: "true"
    vtype: select

- name: Install Oracle Java
  become: yes
  apt:
    name: "oracle-java{{ sansible_java_version }}-installer"
    state: present

- name: Set Oracle Java as default
  become: yes
  apt:
    name: "oracle-java{{ sansible_java_version }}-set-default"
    state: present
  when: sansible_java_set_as_default
